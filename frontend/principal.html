<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tienda Virtual</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>üõçÔ∏è Tienda Virtual & Env√≠os üöö</h1>
    <nav>
      <a href="principal.html">Inicio</a>
      <a href="#">Productos</a>
      <a href="#">Carrito</a>
      <button id="logout">Salir</button>
    </nav>
  </header>

  <!-- Contenedor de productos -->
  <main>
    <h2>Productos</h2>
    <div id="productos-container" class="productos-grid"></div>

    <!-- Carrito -->
    <section class="carrito">
      <h2>üõí Carrito de Compras</h2>
      <ul id="lista-carrito"></ul>
      <p><strong>Total:</strong> $<span id="total">0</span></p>
      <button id="finalizar">Finalizar Compra</button>
    </section>
  </main>

  <script>
    const API_URL = "http://localhost:4000";

    // ================= CARGAR PRODUCTOS ================= //
    async function cargarProductos() {
      try {
        const res = await fetch(`${API_URL}/productos`);
        const productos = await res.json();

        const container = document.getElementById("productos-container");
        container.innerHTML = "";

        productos.forEach(prod => {
          const card = `
            <div class="producto-card">
              <img src="${API_URL}${prod.imagen}" alt="${prod.nombre}" width="150">
              <h3>${prod.nombre}</h3>
              <p>$${prod.precio}</p>
              <button onclick="agregarAlCarrito(${prod.id}, '${prod.nombre}', ${prod.precio})">
                Agregar al carrito
              </button>
            </div>
          `;
          container.innerHTML += card;
        });
      } catch (error) {
        console.error("Error al cargar productos:", error);
      }
    }

    // ================= CARRITO ================= //
    let carrito = [];
    function agregarAlCarrito(id, nombre, precio) {
      carrito.push({ id, nombre, precio });
      renderCarrito();
    }

    function renderCarrito() {
      const lista = document.getElementById("lista-carrito");
      const total = document.getElementById("total");

      lista.innerHTML = "";
      let suma = 0;

      carrito.forEach(item => {
        suma += item.precio;
        const li = document.createElement("li");
        li.textContent = `${item.nombre} - $${item.precio}`;
        lista.appendChild(li);
      });

      total.textContent = suma.toFixed(2);
    }

    // ================= FINALIZAR COMPRA ================= //
    document.getElementById("finalizar").addEventListener("click", () => {
      alert("Compra finalizada. ¬°Gracias por tu pedido!");
      carrito = [];
      renderCarrito();
    });

    // ================= SALIR ================= //
    document.getElementById("logout").addEventListener("click", () => {
      // Borra sesi√≥n (si usas localStorage)
      localStorage.removeItem("user");
      window.location.href = "./LoginForm.jsx";
    });

    // Cargar productos al inicio
    cargarProductos();
  </script>
</body>
</html>
